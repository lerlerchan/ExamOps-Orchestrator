<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ExamOps — Orchestrator Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display+SC:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=JetBrains+Mono:wght@300;400;500&family=Lora:ital,wght@0,400;0,500;0,600;1,400;1,500&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;1,9..40,300&display=swap" rel="stylesheet" />

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    /* ═══════════════════════════════════════════════════════════
       DARK THEME  —  "Midnight Scholar"
       Deep charcoal, warm gold, Playfair Display
    ═══════════════════════════════════════════════════════════ */
    :root,
    [data-theme="dark"] {
      --bg:            #080A0F;
      --surface:       #0E1219;
      --surface2:      #141925;
      --surface3:      #1B2235;
      --border:        #1C2333;
      --border2:       #253048;

      --accent:        #C9922A;
      --accent-dim:    #8A621C;
      --accent-glow:   rgba(201,146,42,0.18);
      --accent-pale:   rgba(201,146,42,0.07);
      --accent-faint:  rgba(201,146,42,0.04);

      --text:          #DDE1EC;
      --text-dim:      #6B768F;
      --text-muted:    #3D4659;

      --green:         #3BC98A;
      --green-dim:     rgba(59,201,138,0.14);
      --red:           #E05252;
      --red-dim:       rgba(224,82,82,0.14);
      --blue:          #4A8EE8;
      --blue-dim:      rgba(74,142,232,0.14);
      --amber:         #E89A30;

      --header-bg:     rgba(8,10,15,0.88);
      --sidebar-bg:    rgba(14,18,25,0.65);
      --shadow:        0 8px 32px rgba(0,0,0,0.45);
      --shadow-sm:     0 2px 8px rgba(0,0,0,0.35);

      --font-display:  'Playfair Display', serif;
      --font-sc:       'Playfair Display SC', serif;
      --font-ui:       'DM Sans', sans-serif;
      --font-mono:     'JetBrains Mono', monospace;
    }

    /* ═══════════════════════════════════════════════════════════
       LIGHT THEME  —  "Parchment & Ink"
       Warm cream, deep forest green, Lora serif
    ═══════════════════════════════════════════════════════════ */
    [data-theme="light"] {
      --bg:            #F2EDE3;
      --surface:       #FDFAF5;
      --surface2:      #F0EBE1;
      --surface3:      #E8E2D8;
      --border:        #D8D2C8;
      --border2:       #C4BDB2;

      --accent:        #2D5A3D;
      --accent-dim:    #1E3D2A;
      --accent-glow:   rgba(45,90,61,0.14);
      --accent-pale:   rgba(45,90,61,0.08);
      --accent-faint:  rgba(45,90,61,0.04);

      --text:          #1A1510;
      --text-dim:      #5C5044;
      --text-muted:    #A89888;

      --green:         #287A52;
      --green-dim:     rgba(40,122,82,0.12);
      --red:           #C0392B;
      --red-dim:       rgba(192,57,43,0.1);
      --blue:          #2C5F8A;
      --blue-dim:      rgba(44,95,138,0.1);
      --amber:         #A0622A;

      --header-bg:     rgba(242,237,227,0.92);
      --sidebar-bg:    rgba(253,250,245,0.8);
      --shadow:        0 8px 32px rgba(90,70,40,0.12);
      --shadow-sm:     0 2px 8px rgba(90,70,40,0.08);

      --font-display:  'Lora', serif;
      --font-sc:       'Lora', serif;
      --font-ui:       'DM Sans', sans-serif;
      --font-mono:     'JetBrains Mono', monospace;
    }

    /* ── BASE ── */
    html { scroll-behavior: smooth; }

    body {
      font-family: var(--font-ui);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
      transition: background 0.35s ease, color 0.35s ease;
    }

    /* Ambient background layer */
    body::before {
      content: '';
      position: fixed; inset: 0; z-index: 0;
      pointer-events: none;
      transition: opacity 0.35s ease;
    }

    [data-theme="dark"] body::before {
      background:
        radial-gradient(ellipse 70% 50% at 12% 18%, rgba(201,146,42,0.07) 0%, transparent 55%),
        radial-gradient(ellipse 55% 40% at 88% 82%, rgba(74,142,232,0.05) 0%, transparent 50%);
    }

    [data-theme="light"] body::before {
      background:
        radial-gradient(ellipse 70% 50% at 10% 15%, rgba(45,90,61,0.06) 0%, transparent 55%),
        radial-gradient(ellipse 50% 35% at 90% 85%, rgba(160,98,42,0.05) 0%, transparent 50%);
    }

    /* ── LAYOUT SHELL ── */
    .shell {
      position: relative; z-index: 1;
      display: grid;
      grid-template-columns: 252px 1fr;
      grid-template-rows: 64px 1fr;
      min-height: 100vh;
    }

    /* ══════════════════════════════════════════
       THEME SWITCHER  — the hero component
    ══════════════════════════════════════════ */
    .theme-switcher {
      display: flex;
      align-items: center;
      background: var(--surface2);
      border: 1.5px solid var(--border2);
      border-radius: 40px;
      padding: 4px;
      gap: 2px;
      position: relative;
      box-shadow: var(--shadow-sm);
      transition: background 0.3s, border-color 0.3s;
    }

    .theme-pill {
      display: flex; align-items: center; gap: 8px;
      padding: 8px 18px;
      border-radius: 32px;
      font-size: 13px; font-weight: 500;
      cursor: pointer;
      border: none;
      background: transparent;
      color: var(--text-dim);
      font-family: var(--font-ui);
      transition: color 0.25s, background 0.25s;
      position: relative; z-index: 1;
      white-space: nowrap;
      line-height: 1;
    }

    .theme-pill:hover { color: var(--text); }

    /* sliding indicator */
    .theme-slider {
      position: absolute;
      top: 4px; bottom: 4px;
      border-radius: 28px;
      background: var(--surface);
      border: 1px solid var(--border2);
      box-shadow: var(--shadow-sm);
      transition: left 0.3s cubic-bezier(.4,0,.2,1), width 0.3s cubic-bezier(.4,0,.2,1), background 0.3s;
      z-index: 0;
    }

    [data-theme="dark"]  .theme-pill[data-mode="dark"]  { color: var(--accent); font-weight: 600; }
    [data-theme="light"] .theme-pill[data-mode="light"] { color: var(--accent); font-weight: 600; }

    /* swatch dots in the pills */
    .pill-swatch {
      width: 10px; height: 10px; border-radius: 50%;
      flex-shrink: 0;
      transition: transform 0.2s;
    }

    .theme-pill:hover .pill-swatch { transform: scale(1.2); }

    .pill-swatch.dark-swatch {
      background: linear-gradient(135deg, #C9922A 40%, #080A0F 100%);
      border: 1px solid rgba(201,146,42,0.5);
    }

    .pill-swatch.light-swatch {
      background: linear-gradient(135deg, #2D5A3D 40%, #F2EDE3 100%);
      border: 1px solid rgba(45,90,61,0.4);
    }

    /* ── TOPBAR ── */
    header {
      grid-column: 1 / -1;
      display: flex; align-items: center; gap: 16px;
      padding: 0 24px;
      border-bottom: 1px solid var(--border);
      background: var(--header-bg);
      backdrop-filter: blur(14px);
      position: sticky; top: 0; z-index: 100;
      transition: background 0.35s, border-color 0.35s;
    }

    .logo {
      display: flex; align-items: center; gap: 10px;
      text-decoration: none; flex-shrink: 0;
    }

    .logo-mark {
      width: 34px; height: 34px; border-radius: 9px;
      background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dim) 100%);
      display: flex; align-items: center; justify-content: center;
      font-family: var(--font-sc);
      font-size: 13px; font-weight: 700;
      color: #fff;
      letter-spacing: -0.5px;
      box-shadow: 0 0 0 1px var(--accent-glow), 0 3px 10px var(--accent-glow);
      transition: background 0.35s, box-shadow 0.35s;
    }

    [data-theme="light"] .logo-mark { color: #fff; }

    .logo-text {
      font-family: var(--font-sc);
      font-size: 15px; font-weight: 400;
      letter-spacing: 0.06em;
      color: var(--text);
      transition: color 0.35s;
    }

    .logo-text span { color: var(--accent); transition: color 0.35s; }

    .header-sep { flex: 1; }

    .header-status {
      display: flex; align-items: center; gap: 6px;
      font-size: 11px; color: var(--text-dim);
      font-family: var(--font-mono);
      padding: 6px 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 20px;
      transition: all 0.35s;
    }

    .dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--green);
      box-shadow: 0 0 5px var(--green);
      animation: pulse-dot 2.2s ease-in-out infinite;
    }

    @keyframes pulse-dot {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.35; }
    }

    /* ── SIDEBAR ── */
    aside {
      border-right: 1px solid var(--border);
      padding: 20px 0;
      background: var(--sidebar-bg);
      display: flex; flex-direction: column;
      overflow-y: auto;
      transition: background 0.35s, border-color 0.35s;
    }

    .sidebar-section { padding: 0 10px 6px; }

    .sidebar-label {
      font-size: 9px; font-weight: 500;
      letter-spacing: 0.2em; text-transform: uppercase;
      color: var(--text-muted);
      font-family: var(--font-mono);
      padding: 0 10px 8px;
      margin-top: 6px;
      transition: color 0.35s;
    }

    .nav-item {
      display: flex; align-items: center; gap: 10px;
      padding: 9px 12px; border-radius: 8px;
      font-size: 13px; color: var(--text-dim);
      cursor: pointer; transition: all .15s;
      margin-bottom: 1px; position: relative;
    }

    .nav-item:hover { background: var(--surface2); color: var(--text); }

    .nav-item.active {
      background: var(--accent-pale);
      color: var(--accent);
      border: 1px solid var(--accent-glow);
    }

    .nav-item.active::before {
      content: '';
      position: absolute; left: -10px; top: 50%;
      transform: translateY(-50%);
      width: 3px; height: 18px;
      background: var(--accent);
      border-radius: 0 2px 2px 0;
      transition: background 0.35s;
    }

    .nav-icon { width: 15px; height: 15px; flex-shrink: 0; opacity: 0.65; }
    .nav-item.active .nav-icon { opacity: 1; }

    .nav-badge {
      margin-left: auto;
      background: var(--accent);
      color: #fff;
      font-size: 9px; font-weight: 700;
      padding: 2px 6px; border-radius: 10px;
      font-family: var(--font-mono);
      transition: background 0.35s;
    }

    [data-theme="light"] .nav-badge { color: #fff; }

    .sidebar-divider { height: 1px; background: var(--border); margin: 10px 18px; transition: background 0.35s; }

    .sidebar-footer {
      margin-top: auto;
      padding: 14px 18px;
      border-top: 1px solid var(--border);
      transition: border-color 0.35s;
    }

    .user-chip { display: flex; align-items: center; gap: 10px; }

    .avatar {
      width: 30px; height: 30px; border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-dim), var(--accent-glow));
      border: 1.5px solid var(--accent-dim);
      display: flex; align-items: center; justify-content: center;
      font-family: var(--font-sc);
      font-size: 11px; color: var(--accent);
      transition: all 0.35s;
    }

    .user-name { font-size: 12px; font-weight: 500; color: var(--text); }
    .user-role { font-size: 10px; color: var(--text-dim); }

    /* ── MAIN ── */
    main {
      padding: 28px 32px;
      overflow-y: auto;
      display: flex; flex-direction: column; gap: 24px;
    }

    /* ── PAGE HEADER ── */
    .page-header { display: flex; align-items: flex-start; justify-content: space-between; }

    .page-title {
      font-family: var(--font-display);
      font-size: 25px; font-weight: 600;
      letter-spacing: -0.02em; color: var(--text);
      line-height: 1.2;
      transition: font-family 0.1s, color 0.35s;
    }

    .page-title em { font-style: italic; color: var(--accent); }

    .page-sub { font-size: 13px; color: var(--text-dim); margin-top: 4px; transition: color 0.35s; }

    /* ── BUTTONS ── */
    .btn {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 9px 18px; border-radius: 7px;
      font-size: 13px; font-weight: 500;
      cursor: pointer; border: none;
      transition: all .18s;
      font-family: var(--font-ui);
      text-decoration: none; line-height: 1;
    }

    .btn-primary {
      background: var(--accent); color: #fff;
      box-shadow: 0 0 0 1px var(--accent-glow), 0 3px 12px var(--accent-glow);
    }

    .btn-primary:hover {
      filter: brightness(1.08);
      box-shadow: 0 0 0 1px var(--accent-glow), 0 6px 20px var(--accent-glow);
      transform: translateY(-1px);
    }

    .btn-ghost {
      background: transparent;
      border: 1px solid var(--border2);
      color: var(--text-dim);
      transition: all .15s;
    }

    .btn-ghost:hover { border-color: var(--accent-dim); color: var(--text); background: var(--accent-faint); }

    /* ── STAT CARDS ── */
    .stats-row {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 14px;
    }

    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 18px 22px;
      position: relative; overflow: hidden;
      transition: border-color .2s, background 0.35s;
    }

    .stat-card::after {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 2px;
    }

    .stat-card.c-gold::after { background: linear-gradient(90deg, transparent, var(--accent), transparent); }
    .stat-card.c-green::after { background: linear-gradient(90deg, transparent, var(--green), transparent); }
    .stat-card.c-blue::after { background: linear-gradient(90deg, transparent, var(--blue), transparent); }
    .stat-card.c-red::after { background: linear-gradient(90deg, transparent, var(--red), transparent); }

    .stat-card:hover { border-color: var(--border2); }

    .stat-label {
      font-size: 9px; font-weight: 500;
      letter-spacing: 0.16em; text-transform: uppercase;
      color: var(--text-muted); font-family: var(--font-mono);
      margin-bottom: 10px; transition: color 0.35s;
    }

    .stat-value {
      font-family: var(--font-display);
      font-size: 30px; font-weight: 600;
      letter-spacing: -0.03em; color: var(--text);
      line-height: 1; margin-bottom: 7px;
      transition: font-family 0.1s, color 0.35s;
    }

    .stat-delta { font-size: 11px; color: var(--text-dim); display: flex; align-items: center; gap: 4px; }
    .stat-delta.up { color: var(--green); }
    .stat-delta.dn { color: var(--red); }

    /* ── UPLOAD SECTION ── */
    .upload-section {
      display: grid; grid-template-columns: 1fr 320px; gap: 18px;
    }

    .upload-zone {
      background: var(--surface);
      border: 2px dashed var(--border2);
      border-radius: 12px; padding: 44px 32px;
      text-align: center; cursor: pointer;
      transition: all .25s; position: relative; overflow: hidden;
    }

    .upload-zone::before {
      content: '';
      position: absolute; inset: 0;
      background: radial-gradient(ellipse 60% 50% at 50% 30%, var(--accent-pale), transparent);
      opacity: 0; transition: opacity .3s;
    }

    .upload-zone:hover::before, .upload-zone.drag-over::before { opacity: 1; }
    .upload-zone:hover, .upload-zone.drag-over {
      border-color: var(--accent-dim);
      background: var(--surface2);
    }

    .upload-icon-wrap {
      width: 60px; height: 60px; margin: 0 auto 18px;
      background: var(--accent-pale);
      border: 1px solid var(--accent-glow);
      border-radius: 15px;
      display: flex; align-items: center; justify-content: center;
      transition: all .25s;
    }

    .upload-zone:hover .upload-icon-wrap {
      background: var(--accent-glow);
      border-color: var(--accent-dim);
      transform: scale(1.06);
    }

    .upload-icon { width: 26px; height: 26px; stroke: var(--accent); fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }

    .upload-title {
      font-family: var(--font-display);
      font-size: 17px; font-weight: 600; color: var(--text);
      margin-bottom: 6px; transition: all 0.35s;
    }

    .upload-sub {
      font-size: 13px; color: var(--text-dim); margin-bottom: 18px;
      line-height: 1.55; transition: color 0.35s;
    }

    .upload-constraints {
      display: flex; align-items: center; justify-content: center; gap: 18px;
      font-size: 11px; color: var(--text-muted);
      font-family: var(--font-mono); transition: color 0.35s;
    }

    #file-input { display: none; }

    /* ── TEMPLATE PANEL ── */
    .template-panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 20px;
      display: flex; flex-direction: column; gap: 14px;
      transition: background 0.35s, border-color 0.35s;
    }

    .panel-title {
      font-size: 12px; font-weight: 600; color: var(--text);
      display: flex; align-items: center; gap: 7px;
      letter-spacing: 0.01em;
    }

    .panel-title-icon { width: 14px; height: 14px; stroke: var(--accent); fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }

    .template-list { display: flex; flex-direction: column; gap: 7px; }

    .template-item {
      display: flex; align-items: center; gap: 11px;
      padding: 11px 13px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px; cursor: pointer;
      transition: all .15s;
    }

    .template-item:hover { border-color: var(--border2); }
    .template-item.selected { border-color: var(--accent-dim); background: var(--accent-pale); }

    .template-radio {
      width: 14px; height: 14px; border-radius: 50%;
      border: 1.5px solid var(--border2); flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      transition: all .15s;
    }

    .template-item.selected .template-radio {
      border-color: var(--accent);
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent-glow);
    }

    .template-item.selected .template-radio::after {
      content: ''; width: 5px; height: 5px;
      border-radius: 50%; background: #fff;
    }

    .template-name { font-size: 12px; font-weight: 500; color: var(--text); }
    .template-meta { font-size: 10px; color: var(--text-dim); margin-top: 1px; font-family: var(--font-mono); }

    .template-tag {
      font-size: 9px; font-weight: 600;
      padding: 2px 7px; border-radius: 10px;
      letter-spacing: 0.06em; text-transform: uppercase;
      background: var(--accent-pale); color: var(--accent);
      border: 1px solid var(--accent-glow);
      margin-left: auto; flex-shrink: 0;
      transition: all 0.35s;
    }

    /* ── PIPELINE ── */
    .pipeline-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px; padding: 24px 26px;
      display: none;
      transition: background 0.35s, border-color 0.35s;
    }

    .pipeline-card.visible { display: block; }

    .pipeline-header {
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 26px;
    }

    .pipeline-title {
      font-family: var(--font-display);
      font-size: 15px; font-weight: 600; color: var(--text);
      transition: all 0.35s;
    }

    .pipeline-filename { font-family: var(--font-mono); font-size: 11px; color: var(--text-dim); margin-top: 3px; }
    .pipeline-pct { font-family: var(--font-display); font-size: 26px; color: var(--accent); transition: all 0.35s; }

    .pipeline-steps { display: flex; position: relative; margin-bottom: 18px; }

    .pipeline-steps::before {
      content: ''; position: absolute;
      top: 20px; left: 20px; right: 20px; height: 2px;
      background: var(--border); transition: background 0.35s;
    }

    .pipeline-bar {
      position: absolute; top: 20px; left: 20px; height: 2px;
      background: linear-gradient(90deg, var(--accent), var(--amber));
      transition: width 0.8s cubic-bezier(.4,0,.2,1);
      box-shadow: 0 0 8px var(--accent-glow);
    }

    .pipeline-step { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 9px; position: relative; z-index: 1; }

    .step-node {
      width: 40px; height: 40px; border-radius: 50%;
      background: var(--surface2); border: 2px solid var(--border);
      display: flex; align-items: center; justify-content: center;
      transition: all .4s; font-family: var(--font-mono);
      font-size: 10px; font-weight: 500; color: var(--text-dim);
    }

    .step-node.done { background: var(--accent); border-color: var(--accent); color: #fff; box-shadow: 0 0 14px var(--accent-glow); }
    .step-node.active { background: var(--surface); border-color: var(--accent); color: var(--accent); box-shadow: 0 0 0 5px var(--accent-faint); animation: step-pulse 1.6s ease-in-out infinite; }

    @keyframes step-pulse {
      0%, 100% { box-shadow: 0 0 0 5px var(--accent-faint); }
      50% { box-shadow: 0 0 0 10px transparent; }
    }

    .step-label { font-size: 10px; color: var(--text-dim); text-align: center; white-space: nowrap; font-family: var(--font-mono); }
    .step-label.active { color: var(--accent); font-weight: 500; }
    .step-label.done { color: var(--text); }

    .pipeline-log {
      background: var(--bg); border: 1px solid var(--border); border-radius: 7px;
      padding: 12px 15px; font-family: var(--font-mono); font-size: 11px;
      color: var(--text-dim); height: 86px; overflow-y: auto; line-height: 1.7;
      transition: background 0.35s, border-color 0.35s;
    }

    .log-line { display: flex; gap: 10px; }
    .log-ts { color: var(--text-muted); flex-shrink: 0; }
    .log-ok { color: var(--green); }
    .log-run { color: var(--accent); }

    /* ── RESULTS ── */
    .results-section { display: grid; grid-template-columns: 1fr 270px; gap: 18px; }

    .diff-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 20px;
      display: flex; flex-direction: column; gap: 13px;
      transition: background 0.35s, border-color 0.35s;
    }

    .card-title {
      font-size: 12px; font-weight: 600; color: var(--text);
      display: flex; align-items: center; gap: 7px;
    }

    .diff-body {
      font-family: var(--font-mono); font-size: 11px; line-height: 1.8;
      overflow-y: auto; max-height: 270px;
      background: var(--bg); border: 1px solid var(--border);
      border-radius: 7px; padding: 10px;
      transition: background 0.35s, border-color 0.35s;
    }

    .diff-line { display: flex; gap: 10px; padding: 0 8px; border-radius: 3px; margin-bottom: 1px; }
    .diff-line-num { color: var(--text-muted); width: 28px; flex-shrink: 0; text-align: right; user-select: none; }
    .diff-line.del { background: var(--red-dim); color: var(--red); }
    .diff-line.add { background: var(--green-dim); color: var(--green); }
    .diff-line.ctx { color: var(--text-dim); }
    .diff-prefix { flex-shrink: 0; width: 12px; }

    .compliance-card {
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 12px; padding: 22px;
      display: flex; flex-direction: column; gap: 0;
      transition: background 0.35s, border-color 0.35s;
    }

    .gauge-wrap { display: flex; justify-content: center; margin: 10px 0 18px; position: relative; height: 130px; }
    .gauge-svg { overflow: visible; }
    .gauge-track { fill: none; stroke: var(--border2); stroke-width: 10; stroke-linecap: round; }
    .gauge-fill { fill: none; stroke: var(--accent); stroke-width: 10; stroke-linecap: round; transition: stroke-dashoffset 1.5s cubic-bezier(.4,0,.2,1), stroke 0.35s; filter: drop-shadow(0 0 5px var(--accent-glow)); }
    .gauge-center { position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    .gauge-pct { font-family: var(--font-display); font-size: 30px; font-weight: 600; color: var(--text); line-height: 1; transition: all 0.35s; }
    .gauge-label { font-size: 10px; color: var(--text-dim); font-family: var(--font-mono); margin-top: 3px; }

    .fix-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .fix-item { background: var(--surface2); border: 1px solid var(--border); border-radius: 7px; padding: 10px 12px; transition: background 0.35s, border-color 0.35s; }
    .fix-count { font-family: var(--font-display); font-size: 20px; font-weight: 600; color: var(--text); transition: all 0.35s; }
    .fix-label { font-size: 10px; color: var(--text-dim); margin-top: 2px; font-family: var(--font-mono); }

    /* ── TABLE ── */
    .table-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; transition: background 0.35s, border-color 0.35s; }

    .table-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px 22px; border-bottom: 1px solid var(--border);
      transition: border-color 0.35s;
    }

    .table-title { font-size: 13px; font-weight: 600; color: var(--text); }

    .search-input {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 7px; padding: 7px 12px;
      font-size: 12px; color: var(--text);
      font-family: var(--font-ui); width: 200px;
      outline: none; transition: border-color .15s, background 0.35s;
    }

    .search-input:focus { border-color: var(--accent-dim); }
    .search-input::placeholder { color: var(--text-muted); }

    table { width: 100%; border-collapse: collapse; }

    thead th {
      font-size: 9px; font-weight: 500;
      letter-spacing: 0.14em; text-transform: uppercase;
      color: var(--text-muted); font-family: var(--font-mono);
      text-align: left; padding: 9px 22px;
      border-bottom: 1px solid var(--border);
      background: var(--surface); transition: color 0.35s, border-color 0.35s;
    }

    tbody tr { border-bottom: 1px solid var(--border); transition: background .12s; cursor: pointer; }
    tbody tr:last-child { border-bottom: none; }
    tbody tr:hover { background: var(--surface2); }

    td { padding: 13px 22px; font-size: 12px; color: var(--text); transition: color 0.35s; }
    td.mono { font-family: var(--font-mono); color: var(--text-dim); }

    .badge {
      display: inline-flex; align-items: center; gap: 5px;
      padding: 3px 9px; border-radius: 20px;
      font-size: 10px; font-weight: 500;
      font-family: var(--font-mono);
    }

    .badge-dot { width: 5px; height: 5px; border-radius: 50%; }
    .badge.done { background: var(--green-dim); color: var(--green); }
    .badge.done .badge-dot { background: var(--green); }
    .badge.running { background: var(--blue-dim); color: var(--blue); }
    .badge.running .badge-dot { background: var(--blue); animation: pulse-dot 1s infinite; }
    .badge.failed { background: var(--red-dim); color: var(--red); }
    .badge.failed .badge-dot { background: var(--red); }

    .score-pill { display: inline-block; font-family: var(--font-mono); font-size: 11px; font-weight: 500; padding: 2px 9px; border-radius: 4px; }
    .score-high { background: var(--green-dim); color: var(--green); }
    .score-mid { background: rgba(160,98,42,0.15); color: var(--amber); }
    .score-low { background: var(--red-dim); color: var(--red); }

    .row-actions { display: flex; gap: 5px; opacity: 0; transition: opacity .15s; }
    tbody tr:hover .row-actions { opacity: 1; }

    .icon-btn {
      width: 25px; height: 25px; background: var(--surface); border: 1px solid var(--border2);
      border-radius: 5px; display: flex; align-items: center; justify-content: center;
      cursor: pointer; transition: all .12s;
    }

    .icon-btn svg { width: 11px; height: 11px; stroke: var(--text-dim); fill: none; stroke-width: 1.5; stroke-linecap: round; stroke-linejoin: round; }
    .icon-btn:hover { border-color: var(--accent-dim); }
    .icon-btn:hover svg { stroke: var(--accent); }

    /* ── ANIMATIONS ── */
    @keyframes fade-up {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .animate { animation: fade-up 0.4s ease both; }
    .stats-row .stat-card:nth-child(1) { animation: fade-up 0.3s 0.05s both; }
    .stats-row .stat-card:nth-child(2) { animation: fade-up 0.3s 0.10s both; }
    .stats-row .stat-card:nth-child(3) { animation: fade-up 0.3s 0.15s both; }
    .stats-row .stat-card:nth-child(4) { animation: fade-up 0.3s 0.20s both; }

    /* ── UPLOAD OVERLAY ── */
    .overlay {
      position: fixed; inset: 0; z-index: 200;
      background: rgba(0,0,0,0.75); backdrop-filter: blur(6px);
      display: flex; align-items: center; justify-content: center;
      opacity: 0; pointer-events: none; transition: opacity .2s;
    }

    [data-theme="light"] .overlay { background: rgba(242,237,227,0.8); }
    .overlay.visible { opacity: 1; pointer-events: auto; }

    .overlay-card {
      background: var(--surface); border: 1px solid var(--border2);
      border-radius: 14px; padding: 36px 44px;
      text-align: center; max-width: 380px; width: 90%;
      box-shadow: var(--shadow); transition: background 0.35s, border-color 0.35s;
    }

    .overlay-title { font-family: var(--font-display); font-size: 18px; font-weight: 600; color: var(--text); margin-bottom: 7px; }
    .overlay-sub { font-size: 13px; color: var(--text-dim); margin-bottom: 24px; line-height: 1.5; }

    .progress-bar-wrap { background: var(--border); border-radius: 3px; height: 4px; margin-bottom: 14px; overflow: hidden; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent), var(--amber)); border-radius: 3px; width: 0%; transition: width .3s ease; box-shadow: 0 0 8px var(--accent-glow); }
    .progress-label { font-size: 11px; color: var(--text-dim); font-family: var(--font-mono); }

    /* ── TOAST ── */
    .toast-wrap { position: fixed; bottom: 24px; right: 24px; display: flex; flex-direction: column; gap: 9px; z-index: 300; }

    .toast {
      display: flex; align-items: center; gap: 12px;
      background: var(--surface2); border: 1px solid var(--border2);
      border-radius: 12px; padding: 12px 16px; min-width: 280px;
      box-shadow: var(--shadow);
      transform: translateX(115%); transition: transform .3s cubic-bezier(.4,0,.2,1), background 0.35s;
    }

    .toast.show { transform: translateX(0); }
    .toast-icon { width: 26px; height: 26px; border-radius: 7px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 12px; }
    .toast.success .toast-icon { background: var(--green-dim); color: var(--green); }
    .toast.error .toast-icon { background: var(--red-dim); color: var(--red); }
    .toast-title { font-size: 12px; font-weight: 600; color: var(--text); }
    .toast-sub { font-size: 11px; color: var(--text-dim); margin-top: 1px; }
    .toast-close { width: 18px; height: 18px; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-dim); font-size: 14px; background: var(--border); border: none; transition: background .12s; margin-left: auto; }
    .toast-close:hover { color: var(--text); }

    /* scrollbar */
    ::-webkit-scrollbar { width: 4px; height: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

    @media (max-width: 1080px) {
      .shell { grid-template-columns: 210px 1fr; }
      .stats-row { grid-template-columns: 1fr 1fr; }
      .upload-section, .results-section { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<div class="shell">

  <!-- ══════════ HEADER ══════════ -->
  <header>
    <a class="logo" href="#">
      <div class="logo-mark">EO</div>
      <span class="logo-text">Exam<span>Ops</span></span>
    </a>

    <div class="header-sep"></div>

    <!-- ━━━ THEME SWITCHER ━━━ -->
    <div class="theme-switcher" id="theme-switcher" role="group" aria-label="Choose display theme">
      <div class="theme-slider" id="theme-slider"></div>

      <button class="theme-pill" data-mode="light" onclick="setTheme('light')" title="Light mode — warm parchment">
        <span class="pill-swatch light-swatch"></span>
        Light
      </button>

      <button class="theme-pill" data-mode="dark" onclick="setTheme('dark')" title="Dark mode — midnight scholar">
        <span class="pill-swatch dark-swatch"></span>
        Dark
      </button>
    </div>

    <div class="header-status">
      <div class="dot"></div>
      <span>Azure Online</span>
    </div>
  </header>

  <!-- ══════════ SIDEBAR ══════════ -->
  <aside>
    <div class="sidebar-section">
      <div class="sidebar-label">Workspace</div>
      <div class="nav-item active">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="2" width="5" height="5" rx="1"/><rect x="9" y="2" width="5" height="5" rx="1"/>
          <rect x="2" y="9" width="5" height="5" rx="1"/><rect x="9" y="9" width="5" height="5" rx="1"/>
        </svg>
        Dashboard
      </div>
      <div class="nav-item">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 2h7l3 3v9H3z"/><path d="M10 2v3h3"/>
          <line x1="5" y1="8" x2="11" y2="8"/><line x1="5" y1="11" x2="8" y2="11"/>
        </svg>
        My Documents
        <span class="nav-badge">14</span>
      </div>
      <div class="nav-item">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="1 4 8 9 15 4"/><rect x="1" y="4" width="14" height="9" rx="1"/>
        </svg>
        Batch Queue
        <span class="nav-badge">3</span>
      </div>
    </div>

    <div class="sidebar-divider"></div>

    <div class="sidebar-section">
      <div class="sidebar-label">Analytics</div>
      <div class="nav-item">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="1 13 5 7 9 10 13 3"/><line x1="1" y1="13" x2="15" y2="13"/>
        </svg>
        Compliance Trends
      </div>
      <div class="nav-item">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="8" cy="8" r="6"/><polyline points="8 4 8 8 11 10"/>
        </svg>
        Audit Log
      </div>
    </div>

    <div class="sidebar-divider"></div>

    <div class="sidebar-section">
      <div class="sidebar-label">Configuration</div>
      <div class="nav-item">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="8" cy="8" r="2.5"/>
          <path d="M8 1v2M8 13v2M1 8h2M13 8h2M3.2 3.2l1.4 1.4M11.4 11.4l1.4 1.4M3.2 12.8l1.4-1.4M11.4 4.6l1.4-1.4"/>
        </svg>
        Format Rules
      </div>
      <div class="nav-item">
        <svg class="nav-icon" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 2h7l3 3v9H3z M6 2v3H3"/>
          <line x1="5" y1="9" x2="11" y2="9"/>
        </svg>
        Templates
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="user-chip">
        <div class="avatar">AL</div>
        <div class="user-info">
          <div class="user-name">Aileen Lee</div>
          <div class="user-role">Exam Coordinator</div>
        </div>
      </div>
    </div>
  </aside>

  <!-- ══════════ MAIN ══════════ -->
  <main>

    <!-- Page header -->
    <div class="page-header animate" style="animation-delay:.05s">
      <div>
        <h1 class="page-title">Format <em>Examination</em> Papers</h1>
        <p class="page-sub">Upload a .docx file — the orchestrator applies institutional formatting rules automatically.</p>
      </div>
      <button class="btn btn-ghost" onclick="showToast('Full history','Detailed history view coming soon.')">
        <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="8" r="6"/><polyline points="8 4 8 8 11 10"/></svg>
        View History
      </button>
    </div>

    <!-- Stats -->
    <div class="stats-row">
      <div class="stat-card c-gold">
        <div class="stat-label">Jobs Today</div>
        <div class="stat-value">47</div>
        <div class="stat-delta up">↑ 12 vs yesterday</div>
      </div>
      <div class="stat-card c-green">
        <div class="stat-label">Avg. Compliance</div>
        <div class="stat-value">94<span style="font-size:17px;color:var(--text-dim)">%</span></div>
        <div class="stat-delta up">↑ 2.3% this week</div>
      </div>
      <div class="stat-card c-blue">
        <div class="stat-label">Avg. Proc. Time</div>
        <div class="stat-value">18<span style="font-size:17px;color:var(--text-dim)">s</span></div>
        <div class="stat-delta">Stable</div>
      </div>
      <div class="stat-card c-red">
        <div class="stat-label">Failed Jobs</div>
        <div class="stat-value">3</div>
        <div class="stat-delta dn">↑ 2 vs yesterday</div>
      </div>
    </div>

    <!-- Upload -->
    <div class="upload-section animate" style="animation-delay:.15s">

      <div class="upload-zone" id="drop-zone"
           onclick="document.getElementById('file-input').click()"
           ondragover="handleDragOver(event)"
           ondragleave="handleDragLeave(event)"
           ondrop="handleDrop(event)">
        <input type="file" id="file-input" accept=".docx" onchange="handleFileSelect(event)" />
        <div class="upload-icon-wrap">
          <svg class="upload-icon" viewBox="0 0 24 24">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="17 8 12 3 7 8"/>
            <line x1="12" y1="3" x2="12" y2="15"/>
          </svg>
        </div>
        <div class="upload-title">Drop your exam paper here</div>
        <div class="upload-sub">
          Drag &amp; drop a <code style="background:var(--surface3);padding:1px 5px;border-radius:3px;font-family:var(--font-mono);font-size:11px">.docx</code> file, or click to browse.<br/>
          Numbering, spacing &amp; header rules applied automatically.
        </div>
        <div class="upload-constraints">
          <span>.docx only</span>
          <span>·</span>
          <span>Max 50 MB</span>
          <span>·</span>
          <span>Results to Teams</span>
        </div>
      </div>

      <div class="template-panel">
        <div class="panel-title">
          <svg class="panel-title-icon" viewBox="0 0 16 16">
            <path d="M3 2h7l3 3v9H3z"/><path d="M10 2v3h3"/>
            <line x1="5" y1="8" x2="11" y2="8"/><line x1="5" y1="11" x2="8" y2="11"/>
          </svg>
          Select Template
        </div>

        <div class="template-list">
          <div class="template-item selected" onclick="selectTemplate(this)">
            <div class="template-radio"></div>
            <div>
              <div class="template-name">SUC Standard 2025</div>
              <div class="template-meta">Updated 14 Feb 2025</div>
            </div>
            <span class="template-tag">Default</span>
          </div>
          <div class="template-item" onclick="selectTemplate(this)">
            <div class="template-radio"></div>
            <div>
              <div class="template-name">Engineering Faculty</div>
              <div class="template-meta">Updated 8 Jan 2025</div>
            </div>
          </div>
          <div class="template-item" onclick="selectTemplate(this)">
            <div class="template-radio"></div>
            <div>
              <div class="template-name">Business &amp; Commerce</div>
              <div class="template-meta">Updated 3 Jan 2025</div>
            </div>
          </div>
          <div class="template-item" onclick="selectTemplate(this)">
            <div class="template-radio"></div>
            <div>
              <div class="template-name">Science &amp; Math</div>
              <div class="template-meta">Updated 20 Dec 2024</div>
            </div>
          </div>
        </div>

        <button class="btn btn-primary" id="format-btn"
                onclick="startFormatting()"
                style="width:100%;justify-content:center;display:none">
          <svg width="12" height="12" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="4 8 7 11 12 5"/>
          </svg>
          Format Document
        </button>
      </div>
    </div>

    <!-- Pipeline -->
    <div class="pipeline-card" id="pipeline-card">
      <div class="pipeline-header">
        <div>
          <div class="pipeline-title">Processing Pipeline</div>
          <div class="pipeline-filename" id="pipeline-filename">—</div>
        </div>
        <div class="pipeline-pct" id="pipeline-pct">0%</div>
      </div>

      <div class="pipeline-steps">
        <div class="pipeline-bar" id="pipeline-bar" style="width:0%"></div>
        <div class="pipeline-step"><div class="step-node" id="step-0">01</div><div class="step-label" id="step-label-0">File Upload</div></div>
        <div class="pipeline-step"><div class="step-node" id="step-1">02</div><div class="step-label" id="step-label-1">Templates</div></div>
        <div class="pipeline-step"><div class="step-node" id="step-2">03</div><div class="step-label" id="step-label-2">Rule-Based</div></div>
        <div class="pipeline-step"><div class="step-node" id="step-3">04</div><div class="step-label" id="step-label-3">LLM Validate</div></div>
        <div class="pipeline-step"><div class="step-node" id="step-4">05</div><div class="step-label" id="step-label-4">Diff Report</div></div>
        <div class="pipeline-step"><div class="step-node" id="step-5">06</div><div class="step-label" id="step-label-5">Deliver</div></div>
      </div>

      <div class="pipeline-log" id="pipeline-log"></div>
    </div>

    <!-- Results -->
    <div class="results-section" id="results-section" style="display:none">
      <div class="diff-card">
        <div class="card-title">
          <svg width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="5" y1="4" x2="15" y2="4"/><line x1="5" y1="8" x2="15" y2="8"/><line x1="5" y1="12" x2="10" y2="12"/>
          </svg>
          Formatting Diff —
          <span style="font-family:var(--font-mono);font-size:10px;color:var(--text-dim)">FIN3201_Final.docx</span>
        </div>
        <div class="diff-body">
          <div class="diff-line del"><span class="diff-line-num">14</span><span class="diff-prefix">−</span><span>Question 1. What is the Fisher equation?</span></div>
          <div class="diff-line add"><span class="diff-line-num">14</span><span class="diff-prefix">+</span><span>Q1. What is the Fisher equation?</span></div>
          <div class="diff-line ctx"><span class="diff-line-num">15</span><span class="diff-prefix"> </span><span style="color:var(--text-muted)">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(5 marks)</span></div>
          <div class="diff-line del"><span class="diff-line-num">16</span><span class="diff-prefix">−</span><span>1a) Define nominal interest rate.</span></div>
          <div class="diff-line add"><span class="diff-line-num">16</span><span class="diff-prefix">+</span><span>(a) Define nominal interest rate.</span></div>
          <div class="diff-line del"><span class="diff-line-num">17</span><span class="diff-prefix">−</span><span>1b) State two limitations of the model.</span></div>
          <div class="diff-line add"><span class="diff-line-num">17</span><span class="diff-prefix">+</span><span>(b) State two limitations of the model.</span></div>
          <div class="diff-line ctx"><span class="diff-line-num">18</span><span class="diff-prefix"> </span><span></span></div>
          <div class="diff-line del"><span class="diff-line-num">19</span><span class="diff-prefix">−</span><span>DATE : 15 March 2025&nbsp;&nbsp;TIME : 2 hours</span></div>
          <div class="diff-line add"><span class="diff-line-num">19</span><span class="diff-prefix">+</span><span>DATE : 15 March 2025 &nbsp; TIME : 2 hours</span></div>
          <div class="diff-line del"><span class="diff-line-num">23</span><span class="diff-prefix">−</span><span>&nbsp;&nbsp;i) Calculate real rate: r = 8%, π = 3%.</span></div>
          <div class="diff-line add"><span class="diff-line-num">23</span><span class="diff-prefix">+</span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(i) Calculate real rate: r = 8%, π = 3%.</span></div>
          <div class="diff-line del"><span class="diff-line-num">24</span><span class="diff-prefix">−</span><span>Marks: 10</span></div>
          <div class="diff-line add"><span class="diff-line-num">24</span><span class="diff-prefix">+</span><span>(10 marks)</span></div>
        </div>
        <div style="display:flex;gap:9px;margin-top:2px">
          <button class="btn btn-primary" style="font-size:12px;padding:8px 15px" onclick="showToast('Downloading','FIN3201_Final_formatted.docx ready.')">
            <svg width="11" height="11" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><path d="M8 2v9M4 9l4 4 4-4"/><line x1="2" y1="14" x2="14" y2="14"/></svg>
            Download .docx
          </button>
          <button class="btn btn-ghost" style="font-size:12px;padding:8px 15px" onclick="showToast('Sent','Diff report posted to Teams.')">
            Post to Teams
          </button>
          <button class="btn btn-ghost" style="font-size:12px;padding:8px 15px;margin-left:auto" onclick="showToast('Report','HTML diff report downloaded.')">
            Full Report
          </button>
        </div>
      </div>

      <div class="compliance-card">
        <div class="card-title">
          <svg width="13" height="13" viewBox="0 0 16 16" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="4 8 7 11 12 5"/><circle cx="8" cy="8" r="6"/>
          </svg>
          Compliance Score
        </div>
        <div class="gauge-wrap">
          <svg class="gauge-svg" width="130" height="130" viewBox="0 0 130 130">
            <circle class="gauge-track" cx="65" cy="65" r="50" stroke-dasharray="236" stroke-dashoffset="59" transform="rotate(135 65 65)"/>
            <circle class="gauge-fill" id="gauge-fill" cx="65" cy="65" r="50" stroke-dasharray="236" stroke-dashoffset="236" transform="rotate(135 65 65)"/>
          </svg>
          <div class="gauge-center">
            <div class="gauge-pct" id="gauge-pct">—</div>
            <div class="gauge-label">compliance</div>
          </div>
        </div>
        <div class="fix-grid">
          <div class="fix-item"><div class="fix-count" id="fix-numbering">—</div><div class="fix-label">numbering</div></div>
          <div class="fix-item"><div class="fix-count" id="fix-spacing">—</div><div class="fix-label">spacing</div></div>
          <div class="fix-item"><div class="fix-count" id="fix-formatting">—</div><div class="fix-label">formatting</div></div>
          <div class="fix-item"><div class="fix-count" id="fix-marks">—</div><div class="fix-label">marks</div></div>
        </div>
      </div>
    </div>

    <!-- Job History -->
    <div class="table-card animate" style="animation-delay:.25s">
      <div class="table-header">
        <div class="table-title">Recent Jobs</div>
        <input class="search-input" type="text" placeholder="Search filename or ID…" oninput="filterTable(this.value)" />
      </div>
      <table id="job-table">
        <thead>
          <tr>
            <th>Job ID</th>
            <th>Filename</th>
            <th>Template</th>
            <th>Status</th>
            <th>Score</th>
            <th>Time</th>
            <th>Submitted</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="job-tbody"></tbody>
      </table>
    </div>

  </main>
</div>

<!-- Overlay -->
<div class="overlay" id="upload-overlay">
  <div class="overlay-card">
    <div class="overlay-title">Uploading to Azure Blob</div>
    <div class="overlay-sub">Transferring to <code style="font-family:var(--font-mono);font-size:11px;background:var(--surface2);padding:1px 5px;border-radius:3px">examops-input</code> container…</div>
    <div class="progress-bar-wrap"><div class="progress-bar" id="upload-bar"></div></div>
    <div class="progress-label" id="upload-label">Preparing…</div>
  </div>
</div>

<!-- Toast -->
<div class="toast-wrap" id="toast-wrap"></div>

<script>
  // ══════════════════════════════════════════════
  //  THEME SWITCHER
  // ══════════════════════════════════════════════
  function setTheme(mode) {
    document.documentElement.setAttribute('data-theme', mode);
    localStorage.setItem('examops-theme', mode);
    positionSlider(mode);
  }

  function positionSlider(mode) {
    const switcher = document.getElementById('theme-switcher');
    const slider   = document.getElementById('theme-slider');
    const pill     = switcher.querySelector(`[data-mode="${mode}"]`);
    if (!pill) return;

    const sw = switcher.getBoundingClientRect();
    const pb = pill.getBoundingClientRect();

    slider.style.left  = (pb.left - sw.left - 4) + 'px';
    slider.style.width = (pb.width + 8) + 'px';
  }

  // Init theme from storage or default dark
  (function() {
    const saved = localStorage.getItem('examops-theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    // delay to let layout paint first
    requestAnimationFrame(() => requestAnimationFrame(() => positionSlider(saved)));
  })();

  window.addEventListener('resize', () => {
    const cur = document.documentElement.getAttribute('data-theme');
    positionSlider(cur);
  });

  // ══════════════════════════════════════════════
  //  JOB DATA
  // ══════════════════════════════════════════════
  const JOBS = [
    { id:'JOB-0091', file:'MATH2301_Midterm.docx',   tpl:'Science & Math',      status:'done',    score:97, time:'12s', sub:'Today, 14:52' },
    { id:'JOB-0090', file:'CS3101_Final.docx',        tpl:'SUC Standard 2025',   status:'running', score:null, time:'—', sub:'Today, 14:49' },
    { id:'JOB-0089', file:'FIN3201_Final.docx',       tpl:'Business & Commerce', status:'done',    score:91, time:'19s', sub:'Today, 14:33' },
    { id:'JOB-0088', file:'ENG2101_Assignment.docx',  tpl:'Engineering Faculty',  status:'done',    score:85, time:'24s', sub:'Today, 13:17' },
    { id:'JOB-0087', file:'BIO1101_Quiz.docx',        tpl:'Science & Math',      status:'failed',  score:null, time:'—', sub:'Today, 12:04' },
    { id:'JOB-0086', file:'ACC3201_Final.docx',       tpl:'Business & Commerce', status:'done',    score:99, time:'14s', sub:'Yesterday' },
    { id:'JOB-0085', file:'PHY2201_Midterm.docx',     tpl:'Science & Math',      status:'done',    score:94, time:'17s', sub:'Yesterday' },
    { id:'JOB-0084', file:'HIST1201_Essay.docx',      tpl:'SUC Standard 2025',   status:'done',    score:78, time:'31s', sub:'Yesterday' },
  ];

  function renderTable(jobs) {
    document.getElementById('job-tbody').innerHTML = jobs.map(j => {
      const badge = j.status === 'done'
        ? `<span class="badge done"><span class="badge-dot"></span>Complete</span>`
        : j.status === 'running'
        ? `<span class="badge running"><span class="badge-dot"></span>Running</span>`
        : `<span class="badge failed"><span class="badge-dot"></span>Failed</span>`;
      const score = j.score !== null
        ? `<span class="score-pill ${j.score>=90?'score-high':j.score>=75?'score-mid':'score-low'}">${j.score}%</span>`
        : `<span style="color:var(--text-muted)">—</span>`;
      return `<tr>
        <td class="mono">${j.id}</td>
        <td style="font-weight:500">${j.file}</td>
        <td class="mono" style="font-size:11px">${j.tpl}</td>
        <td>${badge}</td>
        <td>${score}</td>
        <td class="mono">${j.time}</td>
        <td class="mono" style="font-size:11px;color:var(--text-muted)">${j.sub}</td>
        <td><div class="row-actions">
          <div class="icon-btn" onclick="showToast('Downloading','${j.file}')">
            <svg viewBox="0 0 16 16"><path d="M8 2v9M4 9l4 4 4-4"/><line x1="2" y1="14" x2="14" y2="14"/></svg>
          </div>
          <div class="icon-btn" onclick="showToast('Diff','Loading report…')">
            <svg viewBox="0 0 16 16"><line x1="4" y1="6" x2="12" y2="6"/><line x1="4" y1="10" x2="8" y2="10"/></svg>
          </div>
        </div></td>
      </tr>`;
    }).join('');
  }

  function filterTable(q) {
    const f = q ? JOBS.filter(j =>
      j.file.toLowerCase().includes(q.toLowerCase()) ||
      j.id.toLowerCase().includes(q.toLowerCase())
    ) : JOBS;
    renderTable(f);
  }

  renderTable(JOBS);

  // ══════════════════════════════════════════════
  //  DRAG & DROP
  // ══════════════════════════════════════════════
  let selectedFile = null;

  function handleDragOver(e) { e.preventDefault(); document.getElementById('drop-zone').classList.add('drag-over'); }
  function handleDragLeave() { document.getElementById('drop-zone').classList.remove('drag-over'); }

  function handleDrop(e) {
    e.preventDefault();
    document.getElementById('drop-zone').classList.remove('drag-over');
    const f = e.dataTransfer.files[0];
    if (f && f.name.endsWith('.docx')) processFile(f);
    else showToast('Invalid file', 'Please upload a .docx file.', 'error');
  }

  function handleFileSelect(e) { if (e.target.files[0]) processFile(e.target.files[0]); }

  function processFile(file) {
    selectedFile = file;
    document.getElementById('format-btn').style.display = 'flex';
    document.getElementById('drop-zone').querySelector('.upload-title').textContent = file.name;
    document.getElementById('drop-zone').querySelector('.upload-sub').innerHTML =
      `<strong style="color:var(--green)">${fmt(file.size)}</strong> · Ready to format`;
    showToast('File selected', `${file.name} ready to format.`);
  }

  function fmt(b) { return b < 1048576 ? (b/1024).toFixed(1)+' KB' : (b/1048576).toFixed(1)+' MB'; }

  // ══════════════════════════════════════════════
  //  PIPELINE SIMULATION
  // ══════════════════════════════════════════════
  const STEPS = [
    { log:'Uploading to examops-input blob container…',   ok:'Blob stored — SHA-256 verified.' },
    { log:'Querying Azure AI Search (top-3 rules)…',       ok:'3 template rules retrieved (similarity ≥ 0.87).' },
    { log:'RuleBasedFormatter: numbering pass 1 of 3…',   ok:'Layer 1 complete — 14 transformations applied.' },
    { log:'GPT-4o-mini: validating ambiguous numbering…', ok:'LLM validation passed — compliance 94%.' },
    { log:'Generating HTML diff + summary stats…',         ok:'Diff report generated (32 changes).' },
    { log:'Writing to examops-output, notifying Teams…',  ok:'Output delivered. Job JOB-0092 complete.' },
  ];

  const TIMES = ['14:58:01','14:58:02','14:58:03','14:58:04','14:58:05','14:58:06',
                 '14:58:07','14:58:08','14:58:09','14:58:10','14:58:11','14:58:12'];
  let logCount = 0;
  const sleep = ms => new Promise(r => setTimeout(r, ms));

  async function startFormatting() {
    if (!selectedFile) selectedFile = { name: 'FIN3201_Final.docx' };

    // Upload overlay
    const overlay = document.getElementById('upload-overlay');
    const bar = document.getElementById('upload-bar');
    const label = document.getElementById('upload-label');
    overlay.classList.add('visible');

    for (let p = 0; p <= 100; p += 5) {
      bar.style.width = p + '%';
      label.textContent = `${p}% — transferring bytes…`;
      await sleep(28);
    }
    label.textContent = 'Upload complete ✓';
    await sleep(350);
    overlay.classList.remove('visible');

    // Show pipeline
    const card = document.getElementById('pipeline-card');
    card.classList.add('visible');
    document.getElementById('pipeline-filename').textContent = selectedFile.name;
    logCount = 0;
    document.getElementById('pipeline-log').innerHTML = '';
    card.scrollIntoView({ behavior:'smooth', block:'nearest' });

    for (let i = 0; i < STEPS.length; i++) {
      activate(i); addLog('run', STEPS[i].log);
      await sleep(750 + Math.random() * 550);
      done(i);     addLog('ok',  STEPS[i].ok);
      progress(Math.round(((i+1)/STEPS.length)*100));
      await sleep(160);
    }

    await sleep(280);
    showResults();
  }

  function activate(i) {
    const n = document.getElementById(`step-${i}`);
    const l = document.getElementById(`step-label-${i}`);
    n.className = 'step-node active';
    l.className = 'step-label active';
  }

  function done(i) {
    const n = document.getElementById(`step-${i}`);
    const l = document.getElementById(`step-label-${i}`);
    n.className = 'step-node done';
    n.textContent = '✓';
    l.className = 'step-label done';
  }

  function progress(pct) {
    document.getElementById('pipeline-pct').textContent = pct + '%';
    document.getElementById('pipeline-bar').style.width = (pct * 0.8) + '%';
  }

  function addLog(type, msg) {
    const log = document.getElementById('pipeline-log');
    const cls = type === 'ok' ? 'log-ok' : 'log-run';
    const pfx = type === 'ok' ? '✓' : '▶';
    const div = document.createElement('div');
    div.className = 'log-line';
    div.innerHTML = `<span class="log-ts">${TIMES[logCount++ % TIMES.length]}</span><span class="${cls}">[${pfx}] ${msg}</span>`;
    log.appendChild(div);
    log.scrollTop = log.scrollHeight;
  }

  function showResults() {
    const s = document.getElementById('results-section');
    s.style.display = 'grid';
    s.scrollIntoView({ behavior:'smooth', block:'nearest' });
    animateGauge(94);
    animCounter('fix-numbering', 8);
    animCounter('fix-spacing', 4);
    animCounter('fix-formatting', 14);
    animCounter('fix-marks', 6);
    showToast('Formatting complete', 'FIN3201_Final.docx — 94% compliance.');
  }

  function animateGauge(target) {
    const fill = document.getElementById('gauge-fill');
    const pct  = document.getElementById('gauge-pct');
    const arc  = 236;
    fill.style.strokeDashoffset = arc - (arc * target / 100);
    let cur = 0;
    const step = () => { cur = Math.min(cur+2, target); pct.textContent = cur+'%'; if (cur < target) requestAnimationFrame(step); };
    requestAnimationFrame(step);
  }

  function animCounter(id, target) {
    const el = document.getElementById(id);
    let cur = 0;
    const step = () => { cur = Math.min(cur+1, target); el.textContent = cur; if (cur < target) setTimeout(step, 40); };
    setTimeout(step, 300 + Math.random()*300);
  }

  function selectTemplate(el) {
    document.querySelectorAll('.template-item').forEach(i => i.classList.remove('selected'));
    el.classList.add('selected');
  }

  // ══════════════════════════════════════════════
  //  TOAST
  // ══════════════════════════════════════════════
  function showToast(title, sub, type = 'success') {
    const wrap = document.getElementById('toast-wrap');
    const t = document.createElement('div');
    t.className = `toast ${type}`;
    t.innerHTML = `
      <div class="toast-icon">${type === 'success' ? '✓' : '✕'}</div>
      <div class="toast-text">
        <div class="toast-title">${title}</div>
        <div class="toast-sub">${sub}</div>
      </div>
      <button class="toast-close" onclick="this.closest('.toast').remove()">×</button>`;
    wrap.appendChild(t);
    requestAnimationFrame(() => requestAnimationFrame(() => t.classList.add('show')));
    setTimeout(() => { t.classList.remove('show'); setTimeout(() => t.remove(), 350); }, 4000);
  }
</script>
</body>
</html>
